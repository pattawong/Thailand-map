<html>
    <head>
       
        <meta charset="utf-8">
        <title>Overview of Thailand </title> 
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.6/css/bootstrap.min.css" integrity="sha384-rwoIResjU2yc3z8GV/NPeZWAv56rSmLldC3R/AZzGRnGxQQKnKkoFVhFQhNUwEyJ" crossorigin="anonymous">
        <script src="https://code.jquery.com/jquery-3.1.1.slim.min.js" integrity="sha384-A7FZj7v+d/sdmMqp/nOQwliLvUsJfDHW+k9Omg/a/EheAdgtzNs3hpfag6Ed950n" crossorigin="anonymous"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/tether/1.4.0/js/tether.min.js" integrity="sha384-DztdAPBWPRXSA/3eYEEUWrWCy7G5KFbe8fFjk5JAIxUYHKkDx6Qin1DkWx51bBrb" crossorigin="anonymous"></script>
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.6/js/bootstrap.min.js" integrity="sha384-vBWWzlZJ8ea9aCX4pEW3rVHjgjt7zpkNpZk+02D9phzyeVkE+jo0ieGizqPLForn" crossorigin="anonymous"></script>
        <script src="https://d3js.org/d3.v4.min.js">
        </script>
           <h1 style="background-color:white;" align="center">Basic Well-Being Index in Thailand</h1>
        <style>
        * {
            box-sizing: border-box;
        }

        /* Create three equal columns that floats next to each other */
        .column {
            float: left;
            width: 25%;
            padding: 10px;
            height: 300px; /* Should be removed. Only for demonstration */
        }

        /* Clear floats after the columns */
        .row:after {
            content: "";
            display: table;
            clear: both;
        }
        .ticks {
          font: 10px sans-serif;
        }

        .track,
        .track-inset,
        .track-overlay {
          stroke-linecap: round;
        }

        .track {
          stroke: #000;
          stroke-opacity: 0.3;
          stroke-width: 10px;
        }

        .track-inset {
          stroke: #ddd;
          stroke-width: 8px;
        }

        .track-overlay {
          pointer-events: stroke;
          stroke-width: 50px;
          stroke: transparent;
          cursor: crosshair;
        }

        .handle {
          fill: #fff;
          stroke: #000;
          stroke-opacity: 0.5;
          stroke-width: 1.25px;
        }
        .toolTip {
          position: absolute;
          display: none;
          min-width: 80px;
          height: auto;
          background: none repeat scroll 0 0 #ffffff;
          border: 1px solid #6F257F;
          padding: 14px;
          text-align: center;
        }
        </style>
    </head>
    <body>
 
        <center><p>There are many indexes to consider well looking at the quality of life in Thailand. The provinces of the most debt are just outside of the capital of Thailand, this can be seen throughout 1998-2015. Throughout 2011 to 2018 the province with the most population is Bangkok which is quite understandable since it is the capital. Provinces with the most education are surrounded around the capital as well as Phuket which is a popular destination for tourists. Buddhism is very important to Thai culture and the number of monks that reside in each province in Thailand. With all of these indexes in mind, Thailand is still a very budding and developing country as education, Gross Provincial Product and life expectancy get higher.</p></center>
        
<table>
  <tr>
      <td>
          <svg width="1000" height="1100"></svg>
      </td>
      <td>
          
        <h3><b>Population </b> <button type="button" class=" btn-primary btn-lg" onclick="read_data('density')"  >Population Density</button></h3>
         
         <h3><b>Economy</b> <button type="button" class=" btn-primary btn-lg" onclick="read_data('gpp')" >GPP</button> <button type="button" class=" btn-primary btn-lg" onclick="read_data('poverty')" >Poverty</button> <button type="button" class=" btn-primary btn-lg" onclick="read_data('household debt')" >Debt</button>
          </h3>
          
          <h3><b>Health</b><button type="button" class=" btn-primary btn-lg" onclick="read_data('life')" >Life Expectancy</button></h3>
          
     
          <h3><b>Education</b> <button type="button" class=" btn-primary btn-lg" onclick="read_data('education')" >Years of Schooling</button></h3>
          
     
          <h3><b>Culture</b> <button type="button" class=" btn-primary btn-lg" onclick="read_data('monk')" >Monks</button></h3>
          
     
          <h3><b>Inequality</b> <button type="button" class=" btn-primary btn-lg" onclick="read_data('inequality')" >Inequality</button>
          </h3>
          <br>
          <h3><b>Compare between two provinces</b><br><br><center> <button type="button" class=" btn-primary btn-lg" onclick="compare()" >Compare</button></center>
          </h3>
          

      </td>
  </tr>
</table>

</body>
<script src="https://d3js.org/d3.v4.min.js"></script>
<script src="https://d3js.org/d3-scale-chromatic.v1.min.js"></script>
<script src="https://d3js.org/topojson.v2.min.js"></script>
<script src="https://d3js.org/colorbrewer.v1.min.js"></script>
<script>

function compare()
    {
        window.location = "comparison.html?p1=" + province_selector[0] + "&p2=" + province_selector[1] + "&cat=" + category;
    }
    
//return color according to scale and grey if data is missing
function get_color(value)
    {
        if(!isNaN(value))
            {
                return color(value);
            }
        else
        {   
            return "grey";    
        }
    }
        
//Data collection
var data = {}
//Max value
var max_data = 40000; 
var min_data = 185;
//Category [Description,Scale,Color,filename,unit]
var data_info = {"household debt":["Household Debt",[200, 1000, 3000, 4000, 5000, 6000, 7000, 8000, 10000],d3.schemeReds[9],"household debt.csv","USD"],"household income":["Household Income per Month",[100, 1000, 2000, 5000, 10000, 20000, 30000, 40000, 50000],d3.schemeGnBu[9],"household income.csv","USD"],"inequality":["Inequality Gini coefficient",[0.05,0.1, 0.15, 0.2, 0.25, 0.3, 0.35,0.4,0.45],d3.schemeOranges[9],"inequality.csv",""],"gpp":["Gross Provincial Product at Current Market Price per Capita",[50000, 100000, 200000, 300000, 400000, 500000, 600000, 800000, 1000000],d3.schemeGreens[9],"gpp.csv","USD"],"monk":["Number of Monks",[500, 1000, 2000, 3500, 5000, 7500, 10000, 12500,15000],d3.schemeYlOrBr[9],"monk.csv",""],"education":["Number of Years in Education",[6, 6.5, 7, 7.5, 8, 9, 10, 11, 12],d3.schemePurples[9],"education.csv","years"],"poverty":["Poverty Line",[40, 50, 60, 70, 80, 90, 100, 150,200],d3.schemeYlGnBu[9],"poverty.csv","USD"],"life":["Life Expectancy",[ 74, 75,76, 77, 78, 79, 80, 81,82],d3.schemeBlues[9],"life_expect_m.csv","Years"],"density":["Population Density",[50, 100, 250, 500, 1000, 2000, 3000, 4000, 5000],d3.schemePuRd[9],"population_density.csv","Persons/Square Km"]};
    
//Define tooltip
var tooltip;
var tooltip_body
var legend_text;
//Global variable
var category ;
var year ="1998";
var min_year = 1998;
var max_year = 2018;

var province_selector = ["",""];

    
//Define Slider
var slider;  
var handle;
//Define SVG
var svg = d3.select("svg"),
    margin = {right: 50, left: 50, top: 250, bottom:1050},
    width = +svg.attr("width") - margin.left - margin.right,
    height = +svg.attr("height");

var svg = d3.select("svg"),
    width = +svg.attr("width"),
    height = +svg.attr("height");

var path = d3.geoPath();

//Color scheme        
var color = d3.scaleThreshold()
    .domain([1000, 5000, 100000, 150000, 200000, 250000, 300000, 350000,400000])
    .range(d3.schemeOrRd[9]);

var x = d3.scaleSqrt()
    .domain([0, 40000])
    .rangeRound([440, 950]);

var slider_x = d3.scaleLinear()
    .domain([1998, 2018])
    .range([0, width*0.9])
    .clamp(true);

//Slider move handler
function slider_move(h) {
  if(h<=min_year)
      {
          h=min_year;
      }
  if(h>=max_year)
      {
          h=max_year;
      }
    handle.attr("cx", slider_x(Math.round(h)));
    year = "" + (Math.round(h));
    updateGraph();
}
//Read csv file
function read_data(cat)
{
    //Get filename according to category
    var filename= data_info[cat][3];
    category = cat;
    //Rest data and max scale
    data = {};
    max_data = 0;
    min_data = 999999999;
    
    //Read data from csv file
    d3.csv(filename, function(d) {
    //Get columns(years)
    var columns = d.columns.slice(1);
    //Update Slider position
    year = columns[0];
        
    min_year = parseInt(columns[0]);
    max_year = parseInt(columns[columns.length-1]);
        
    handle.attr("cx", slider_x(Math.round(year)));
    //Arrange csv data into data variable
    for ( var i=0; i<d.length; i++)
    {
     var province = d[i].province;
     data[province] = {};
     columns.forEach(function(c,j) { 
     data[province][c] = parseFloat(d[i][c]);
     //Looking for max value
     if(data[province][c]>=max_data)
         {
             max_data = data[province][c];
         }
     if(data[province][c]<=min_data)
         {
             min_data = data[province][c];
             //console.log(min_data,province,c);
         }         
     });
    }
        
    //Update Scale
    color = d3.scaleThreshold()
    .domain(data_info[cat][1])
    .range(data_info[cat][2]);
    console.log(max_data);
        console.log(min_data);
    x = d3.scaleSqrt()
    .domain([min_data, max_data])
    .rangeRound([440, 950]);
    });

    //Update graph
    updateGraph();
}

//Do some work!      
read_data("household debt");        

function draw_scale()
{

    if(data_info[category][4]=="")
        {
            legend_text =     data_info[category][0];
        }
    else { legend_text = data_info[category][0] + " (" + data_info[category][4] +")";}
    //Add Scale/Legend
    var g = svg.append("g")
        .attr("class", "key")
        .attr("transform", "translate(0,40)");
    
    g.selectAll("rect")
      .data(color.range().map(function(d) {
          d = color.invertExtent(d);
          if (d[0] == null) d[0] = x.domain()[0];
          if (d[1] == null) d[1] = x.domain()[1];
          return d;
        }))
      .enter().append("rect")
        .attr("height", 8)
        .attr("x", function(d) { return x(d[0]); })
        .attr("width", function(d) { return x(d[1]) - x(d[0]); })
        .attr("fill", function(d) { return color(d[0]); });
    
    
    g.append("text")
        .attr("class", "caption")
        .attr("x", x.range()[0])
        .attr("y", -6)
        .attr("fill", "#000")
        .attr("text-anchor", "start")
        .attr("font-weight", "bold")
        .text(legend_text);

    g.call(d3.axisBottom(x)
        .tickSize(13)
        .tickValues(color.domain()))
      .select(".domain")
        .remove();
}

function click_province(province)
{   

    var select_element = d3.select("#"+province);
    
    //Province already in list > will be remove
    if(province_selector.includes(province))
        {
           province_selector[province_selector.indexOf(province)] = ""; 
           select_element.attr("fill",select_element.attr("original_fill"));
        }
    else {
        //Check empty slot
        if(province_selector.includes(""))
            {
            //Put province in empty slot
            province_selector[province_selector.indexOf("")] = province; 
            select_element.attr("fill","red");
            }
    }
}

function updateGraph(){ 
    
    d3.selectAll("g > *").remove();
    d3.selectAll("text").remove();
    
    tooltip = d3.select("body").append("div").attr("class", "toolTip");
    //Insert Slider bar
    slider = svg.append("g")
    .attr("class", "slider")
    .attr("transform", "translate(" + margin.left + "," + margin.bottom+ ")");

    slider.append("line")
    .attr("class", "track")
    .attr("x1", slider_x.range()[0])
    .attr("x2", slider_x.range()[1])
    .select(function() { return this.parentNode.appendChild(this.cloneNode(true)); })
    .attr("class", "track-inset")
    .select(function() { return this.parentNode.appendChild(this.cloneNode(true)); })
    .attr("class", "track-overlay")
    .call(d3.drag()
        .on("start.interrupt", function() { slider.interrupt(); })
        .on("start drag", function() { slider_move(slider_x.invert(d3.event.x)); }));

    slider.insert("g", ".track-overlay")
    .attr("class", "ticks")
    .attr("transform", "translate(0," + 25 + ")")
    .selectAll("text")
    .data(slider_x.ticks(10))
    .enter().append("text")
    .attr("x", slider_x)
    .attr("text-anchor", "middle")
    .attr("font-size","20px")
    .text(function(d) { return d; });

    handle = slider.insert("circle", ".track-overlay")
    .attr("class", "handle")
    .attr("r", 9);

    slider.transition() 
    .duration(750)
    //Set slider position
    handle.attr("cx", slider_x(Math.round(year)));


    d3.json("th.json", function(error, topology) {
      if (error) throw error;
        //console.log("draw");
        draw_scale();
        
        svg.append("g")
        .selectAll("path")
        .data(topojson.feature(topology, topology.objects.provinces).features)
        .enter().append("path")
          .attr("class","path1")
          .attr("fill", function(d) { return get_color(data[d.properties.Adm1Name][year]); })
          .attr("original_fill", function(d) { return get_color(data[d.properties.Adm1Name][year]); })
          .attr("id", function(d) { return d.properties.Adm1Name.split(' ').join('_');})
          .attr("stroke", "#000")
          .attr("stroke-opacity", 0.3)
          .attr('transform', 'rotate(70)')
          .attr('transform-origin', '50% 50%')
          .attr("d", path)
          .on("mouseover", function(d){
               if(data_info[category][4]=="USD") { tooltip_body = (d.properties.Adm1Name) + "<br>Year: " + (year)+ "<br>" + data_info[category][0] + ": " + (data[d.properties.Adm1Name][year].toFixed(2)) + " " + data_info[category][4] + "<br>(" +(data[d.properties.Adm1Name][year]*32).toFixed(2) +" THB)"; }
               else if(data_info[category][4]!=="") { tooltip_body = (d.properties.Adm1Name) + "<br>Year: " + (year)+ "<br>" + data_info[category][0] + ": " + (data[d.properties.Adm1Name][year].toFixed(2)) +" " + data_info[category][4] ; }
               else { tooltip_body = (d.properties.Adm1Name) + "<br>Year: " + (year)+ "<br>" + data_info[category][0] + ": " + (data[d.properties.Adm1Name][year]).toFixed(2); }
                
               tooltip_body;
               tooltip.transition()
               .duration(200)
               .style("opacity", .9); //from the textbook
               tooltip
                 .style("left", d3.event.pageX + 30 + "px")
                 .style("top", d3.event.pageY - 70 + "px")
                 .style("display", "inline-block")
                 .html(tooltip_body);
           })
            .on("mouseout", function(d){
            tooltip.style("display", "none").style("opacity", 0);})
            .on("click",function(d) { click_province(d.properties.Adm1Name.split(' ').join('_'));})
    });   
    
};
    </script>


            <p> <b>Created by:</b> Pattawong Pansodtee and Victoria Ly in collaboration with Professor Lodha </p>
            <p> <b>Designed for:</b> CMPS 263 Data Visualization Winter 2018 </p>

    <center>      
        <div class="row">
              <div class="column" style=" ">
                <h3>Files Submitted</h3>
                <p>index.html</p>
                <p>THA.json</p>
              </div>
              <div class="column" style=" ">
                <h3>Data Sources:</h3>
                <p>National Statistics Office of Thailand</p>
              </div>
              <div class="column" style=" ">
                <h3>Vizualization Sources</h3>
                <p>Some text..</p>
              </div>
              <div class="column" style=" ">
                <h3>References</h3>
                <p>Some text..</p>
              </div>
            </div>
    </center>
</html>